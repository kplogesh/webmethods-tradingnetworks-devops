pipeline {
    agent any 
    environment {
        git_branch_name = 'develop'
        dev_namespace= 'development'
        stg_namespace= 'staging'
        dev_env_name = 'development'
        stg_env_name = 'staging'
    }    
    stages {
        stage('DEV - TN Export Task - K8S') { 
            steps {
                sh "chmod +x -R ${env.WORKSPACE}"
                withCredentials([file(credentialsId: 'vadigcs62496k8s', variable: 'KUBECONFIG')]) 
                {
                    sh 'pipeline/common.lib/export-task.sh ${BUILD_NUMBER} ${dev_env_name} ${dev_namespace} ${git_branch_name}'
                }
            }
        }                    
        stage('Staging - TN Import Job - K8S') { 
            steps {
                withCredentials([file(credentialsId: 'vadigcs62496-staging', variable: 'KUBECONFIG')]) 
                {
                    sh 'pipeline/common.lib/import-task.sh ${BUILD_NUMBER} ${stg_env_name} ${stg_namespace}'
                }
            }
        }
        stage('Build Application Image') { 
            steps {
                sh 'pipeline/common.lib/build-task.sh ${BUILD_NUMBER}'
            }
        }         
        stage('Staging - Deploy MSR - K8S') { 
            steps {
                withCredentials([file(credentialsId: 'vadigcs62496-staging', variable: 'KUBECONFIG')]) 
                {
                    sh 'pipeline/common.lib/deploy-task.sh ${BUILD_NUMBER} ${stg_env_name} ${stg_namespace}'
                }
            }
        }    
    }   
}