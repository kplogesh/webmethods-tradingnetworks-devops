pipeline {
    agent any 
    environment {
        prd_namespace= 'production'
        prd_env_name = 'production'  
        MAJOR = sh(script: '`sed -n 's/^MAJOR=\(.*\)/\1/p' < applications/tradingnetworks/version.txt`', returnStdout: true)      
    }    
    stages {
        stage('PRD DB Import') {         
            steps {
                sh "chmod +x -R ${env.WORKSPACE}"
                withCredentials([file(credentialsId: 'vadigcs62496-production', variable: 'KUBECONFIG')]) 
                {
                    sh 'pipeline/common.lib/import-task.sh ${BUILD_NUMBER} ${prd_env_name} ${prd_namespace}'
                }
            }
        }        
        stage('PRD Deploy') {               
            steps {
                withCredentials([file(credentialsId: 'vadigcs62496-production', variable: 'KUBECONFIG')]) 
                {
                    sh 'pipeline/common.lib/deploy-task.sh ${BUILD_NUMBER} ${prd_env_name} ${prd_namespace}'
                }
            } 
        }               
    }   
}